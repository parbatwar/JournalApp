@page "/"
@layout EmptyLayout

@using JournalApp.Services.UserService
@inject IUserService UserService
@inject NavigationManager Nav


<EditForm Model="login" OnValidSubmit="DoLogin">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="login-bg">
        <div class="login-card">

            @if (!string.IsNullOrEmpty(error))
            {
                <p class="text-danger text-center mb-3">@error</p>
            }

            <div class="avatar">
                <div class="avatar-icon">👤</div>
            </div>

            <div class="field">
                <InputText class="form-control"
                           placeholder="Username"
                           @bind-Value="login.Username" />
            </div>

            <div class="field">
                <InputText class="form-control"
                           type="password"
                           placeholder="Password"
                           @bind-Value="login.Password" />
            </div>

            <button class="login-btn mb-3" type="submit">
                LOGIN
            </button>

            <NavLink href="/register"
                     class="mt-3 text-center text-white text-decoration-none">
                Create new account
            </NavLink>

        </div>
    </div>
</EditForm>

@code {
    UserDto login = new();   // simple DTO
    string error = "";

    void DoLogin()
    {
        var success = UserService.Login(login);

        if (!success)
        {
            error = "Wrong username or password";
            return;
        }

        Nav.NavigateTo("/add-entry");
    }
}
