@page "/entry/{EntryId:int}"
@layout MainLayout
@using JournalApp.Models
@using JournalApp.Services.EntryService
@inject IEntryService EntryService
@inject NavigationManager Nav

<div class="page-header d-flex justify-content-between align-items-center">
    <div>
        <h1>Journal Entry</h1>
        <p>Review your captured moment</p>
    </div>
    <button class="btn-back" @onclick='() => Nav.NavigateTo("/all-entries")'>
        <i class="bi bi-arrow-left"></i> Back
    </button>
</div>

@if (Entry == null)
{
    <div class="text-center p-5">
        <div class="spinner-border text-primary" role="status"></div>
    </div>
}
else
{
    <div class="card premium-view-card border-0 shadow">
        <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-start mb-4">
                <h2 class="entry-display-title">@Entry.Title</h2>
                <span class="date-badge">
                    <i class="bi bi-calendar3"></i> @Entry.EntryDate.ToString("MMMM dd, yyyy")
                </span>
            </div>

            <div class="d-flex flex-wrap gap-2 mb-4">
                @foreach (var m in Entry.EntryMoods)
                {
                    <span class="mood-pill">
                        <i class="bi bi-emoji-smile"></i> @m.Mood?.MoodName
                    </span>
                }
                @if (Entry.Tag != null)
                {
                    <span class="tag-pill">
                        <i class="bi bi-tag"></i> @Entry.Tag.TagName
                    </span>
                }
            </div>

            <div class="entry-content-box">
                @((MarkupString)Entry.Content)
            </div>

            <div class="metadata-footer mt-5 pt-3 border-top d-flex justify-content-between text-muted">
                <small><i class="bi bi-clock"></i> Created: @Entry.CreatedAt.ToString("MMM dd, hh:mm tt")</small>
                <small><i class="bi bi-pencil-square"></i> Last Update: @Entry.UpdatedAt.ToString("MMM dd, hh:mm tt")</small>
            </div>
        </div>

        <div class="card-footer bg-white border-0 p-4 d-flex gap-3">
            <button class="btn btn-edit flex-grow-1" @onclick="EditEntry">
                <i class="bi bi-pencil"></i> Edit Entry
            </button>
            <button class="btn btn-delete" @onclick="DeleteEntry">
                <i class="bi bi-trash"></i>
            </button>
        </div>
    </div>
}


@code {
    [Parameter]
    public int EntryId { get; set; }

    JournalEntry Entry = null!;

    protected override async Task OnInitializedAsync()
    {
        Entry = await EntryService.GetEntryById(EntryId);
    }

    void EditEntry()
    {
        Nav.NavigateTo($"/edit-entry/{EntryId}");
    }

    async Task DeleteEntry()
    {
        bool confirm = await Application.Current!.Windows[0].Page!
            .DisplayAlertAsync(
                "Confirm",
                "Are you sure you want to delete?",
                "Yes",
                "No"
            );

        if (!confirm)
            return;

        await EntryService.DeleteEntry(EntryId);

        await Application.Current!.Windows[0].Page!
            .DisplayAlertAsync(
                "Deleted",
                "Journal entry deleted successfully",
                "OK"
            );

        Nav.NavigateTo("/all-entries");
    }
}
