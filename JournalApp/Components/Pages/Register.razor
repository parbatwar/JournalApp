@page "/register"
@layout EmptyLayout

@using JournalApp.Services.UserService
@inject IUserService UserService
@inject NavigationManager Nav


<EditForm Model="user" OnValidSubmit="DoRegister">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="register-bg">
        <div class="register-card">

            @if (!string.IsNullOrEmpty(error))
            {
                <p class="text-danger text-center mb-3">@error</p>
            }

            <div class="avatar">
                <div class="avatar-icon">👤</div>
            </div>

            <div class="field">
                <InputText class="form-control"
                           placeholder="Username"
                           @bind-Value="user.Username" />
            </div>

            <div class="field">
                <InputText class="form-control"
                           type="password"
                           placeholder="Password"
                           @bind-Value="user.Password" />
            </div>

            <button class="register-btn mb-3" type="submit">
                REGISTER
            </button>

            <NavLink href="/"
                     class="mt-3 text-center text-decoration-none text-white">
                Already have account?
            </NavLink>

        </div>
    </div>
</EditForm>

@code {
    UserDto user = new();   // DTO = form model
    string error = "";

    void DoRegister()
    {
        try
        {
            UserService.SignUp(user);   // signup
            Nav.NavigateTo("/");
        }
        catch (Exception ex)
        {
            error = ex.Message; // "User already exists"
        }
    }
}
